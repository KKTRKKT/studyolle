<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{fragments/layout :: layout (_, ~{::body}, ~{})}">

<body>
<script>$(function (){ $('body').addClass("bg-white"); })</script>
<div class="col-12 py-5">
    <div class="row">
        <div class="col-md-8">
            <div class="row">
                <span class="h2 col-8">
                    <a class="text-decoration-none" th:href="@{'/study/' + ${study.path} + '/events'}">
                        <span th:text="${study.title}"></span>
                    </a>
                    / <span th:text="${event.title}"></span>
                </span>
                <div class="col row gap-2 justify-content-end">
                    <div class="w-auto d-md-block text-end">
                        <a class="btn btn-outline-primary" th:href="@{'/study/' + ${study.path} + '/event/' + ${event.id} + '/edit'}"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> 수정</a>
                    </div>
                    <div class="w-auto d-md-block text-end">
                            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#delete-modal">
                                <i class="fa fa-trash-o" aria-hidden="true"></i> 삭제
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="mt-3" th:utext="${event.description}">Description</div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="border-top border-4 mb-3"></div>
            <div class="mb-3">
                <h5>모집방법</h5>
                <span th:text="${event.eventType.description}"></span>
            </div>
            <div class="mb-3">
                <h5>신청 마감일</h5>
                <span th:text="${#temporals.format(event.endEnrollmentDateTime, 'yyyy년 MM월 dd일 EEEE a hh:mm')}"></span>
            </div>
            <div class="mb-3">
                <h5>일시</h5>
                <span th:text="${#temporals.format(event.startDateTime, 'yyyy년 MM월 dd일 EEEE a hh:mm')}"></span> ~<br>
                <span th:text="${#temporals.format(event.endDateTime, 'yyyy년 MM월 dd일 EEEE a hh:mm')}"></span>
            </div>
            <div class="mb-3">
                <h5>모임장</h5>
                <a th:href="@{'/profile/' + ${event.createdBy.nickname}}" class="btn justify-content-between btn-light">
                    <th:block th:replace="~{fragments/header :: profileImage (${event.createdBy.profileImage}, ${event.createdBy.email})}"></th:block>
                    <span class="ms-2 pe-none" th:text="${event.createdBy.nickname}"></span>
                    <i class="fa fa-external-link" aria-hidden="true"></i>
                </a>
            </div>
            <div class="mb-3">
                <h5>모임 참가 신청 (<span th:text="${event.enrollments.size()}"></span>)</h5>
                <div class="row row-cols-2">
                    <span th:if="${event.enrollments.isEmpty}" class="text-muted">참가 신청이 없습니다</span>
                    <div th:each="enrollment : ${event.enrollments}" class="col mb-3">
                        <a th:href="@{'/profile/' + ${enrollment.account.nickname}}" class="btn justify-content-between" th:classappend="${enrollment.accepted} ? 'btn-outline-success' : 'btn-light'">
                            <th:block th:replace="~{fragments/header :: profileImage (${enrollment.account.profileImage}, ${enrollment.account.email})}"></th:block>
                            <span class="ms-2 pe-none" th:text="${enrollment.account.nickname}"></span>
                            <i th:if="${enrollment.accepted}" class="fa fa-check" aria-hidden="true"></i>
                            <i th:if="${!enrollment.accepted}" class="fa fa-ellipsis-h" aria-hidden="true"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <h5>신청인원 / 모집인원</h5>
                <span th:text="${event.enrollments.size()}"></span> /
                <span th:text="${event.limitOfEnrollments}"></span>
            </div>
            <div class="form-group d-grid gap-2">
                <button type="submit" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#join-modal">참가하기</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="delete-modal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="deleteModalLabel" th:text="${event.title}"></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>모임을 삭제하시겠습니까?</p>
                <p>확인하시면 본 모임 및 참가 신청 관련 데이터를 삭제합니다.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                <form method="post" th:action="@{'/study/' + ${study.path} + '/event/' + ${event.id} + '/delete'}">
                    <button type="submit" class="btn btn-primary">확인</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="join-modal" tabindex="-1" aria-labelledby="joinModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="joinModalLabel" th:text="${event.title}"></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>모임에 참석하시겠습니까? 일정을 캘린더에 등록해 두시면 좋습니다.</p>
                <p>확인 버튼을 클릭하면 모임 참가 신청을 합니다.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                <form method="post" th:action="@{'/study/' + ${study.path} + '/event/' + ${event.id} + '/join'}">
                    <button type="submit" class="btn btn-primary">확인</button>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
</html>